# テストケース

このドキュメントでは、Excel AI チャットアシスタントの包括的なテストケースを説明します。

## テスト環境の準備

### 1. テストデータの作成

以下のテストデータをExcelに入力してください。

#### テストデータセット1：売上データ

```
A1: 日付          B1: 売上（万円）  C1: 商品
A2: 2025-01-01    B2: 100          C2: 商品A
A3: 2025-01-02    B3: 150          C3: 商品B
A4: 2025-01-03    B4: 120          C4: 商品A
A5: 2025-01-04    B5: 200          C5: 商品C
A6: 2025-01-05    B6: 180          C6: 商品B
A7: 2025-01-06    B7: 220          C7: 商品A
A8: 2025-01-07    B8: 190          C8: 商品C
A9: 2025-01-08    B9: 210          C9: 商品B
A10: 2025-01-09   B10: 230         C10: 商品A
```

#### テストデータセット2：空白を含むデータ

```
A1: 1月    B1: 100
A2: 2月    B2: 
A3: 3月    B3: 150
A4: 4月    B4: 
A5: 5月    B5: 200
A6: 6月    B6: 
A7: 7月    B7: 250
A8: 8月    B8: 
A9: 9月    B9: 300
A10: 10月  B10: 
```

#### テストデータセット3：複雑なデータ

```
A1: 商品    B1: Q1    C1: Q2    D1: Q3    E1: Q4
A2: 商品A   B2: 1000  C2: 1200  D2: 1100  E2: 1300
A3: 商品B   B3: 800   C3: 900   D3: 950   E3: 1100
A4: 商品C   B4: 1200  C4: 1400  D4: 1350  E4: 1500
```

## テストケース

### グループ1：基本的なデータ分析

#### テスト1.1：基本統計情報の計算
**前提条件**: テストデータセット1のB2:B10を選択

**操作**:
```
入力: 「このデータを分析して」
```

**期待される結果**:
- チャットに以下の統計情報が表示される
  - 合計: 1,490
  - 平均: 165.56
  - 最大値: 230
  - 最小値: 100
  - 中央値: 190
- セルに結果が自動出力される

**検証項目**:
- [ ] 統計値が正確に計算されている
- [ ] メッセージが日本語で表示されている
- [ ] セルに結果が書き込まれている

---

#### テスト1.2：異常値の検出
**前提条件**: テストデータセット1のB2:B10を選択

**操作**:
```
入力: 「異常値を見つけて」
```

**期待される結果**:
- 異常値が検出される（または「異常値なし」と表示）
- 検出方法（IQR法）が説明される

**検証項目**:
- [ ] 異常値検出が実行される
- [ ] 結果が適切に表示される

---

### グループ2：データ操作

#### テスト2.1：空白セルの補完
**前提条件**: テストデータセット2のA1:B10を選択

**操作**:
```
入力: 「空白を埋めて」
```

**期待される結果**:
- 空白セルが線形補間で埋められる
  - B2: 125（100と150の中間）
  - B4: 175（150と200の中間）
  - B6: 225（200と250の中間）
  - B8: 275（250と300の中間）
  - B10: 325（300の延長）
- セルに結果が反映される

**検証項目**:
- [ ] 空白が正確に補完されている
- [ ] 線形補間が正しく計算されている
- [ ] セルに結果が書き込まれている

---

#### テスト2.2：データのソート
**前提条件**: テストデータセット1のA1:C10を選択

**操作**:
```
入力: 「売上でソートして」
```

**期待される結果**:
- データが売上（B列）の昇順でソートされる
- 最小値（100）が最上位、最大値（230）が最下位

**検証項目**:
- [ ] ソートが正確に実行されている
- [ ] 関連データ（日付、商品）も一緒に移動している

---

#### テスト2.3：重複削除
**前提条件**: 重複データを含むシートを作成

**操作**:
```
入力: 「重複を削除して」
```

**期待される結果**:
- 重複行が削除される
- ユニークなデータのみが残る

**検証項目**:
- [ ] 重複が正確に検出されている
- [ ] 削除後のデータが正確である

---

### グループ3：レポート生成

#### テスト3.1：月次レポート作成
**前提条件**: テストデータセット1のA1:C10を選択

**操作**:
```
入力: 「月次レポート作成」
```

**期待される結果**:
- 新しいシートが作成される（または別の場所に出力）
- レポートに以下の情報が含まれる
  - データ範囲
  - 統計情報（合計、平均、最大値、最小値）
  - データ数

**検証項目**:
- [ ] レポートが生成される
- [ ] 統計情報が正確である
- [ ] フォーマットが見やすい

---

#### テスト3.2：サマリーシート作成
**前提条件**: テストデータセット3のA1:E4を選択

**操作**:
```
入力: 「サマリーシート作成」
```

**期待される結果**:
- 新しいシートに集計結果が出力される
- 商品別の売上合計が表示される

**検証項目**:
- [ ] サマリーシートが生成される
- [ ] 集計が正確である

---

### グループ4：グラフ生成

#### テスト4.1：折れ線グラフ作成
**前提条件**: テストデータセット1のA1:B10を選択

**操作**:
```
入力: 「推移グラフ作って」
```

**期待される結果**:
- 折れ線グラフが自動生成される
- X軸：日付、Y軸：売上
- グラフタイトル：「売上推移」

**検証項目**:
- [ ] グラフが生成される
- [ ] 軸ラベルが正確である
- [ ] データが正確に表示されている

---

#### テスト4.2：円グラフ作成
**前提条件**: テストデータセット3のA1:B4を選択

**操作**:
```
入力: 「円グラフで表示」
```

**期待される結果**:
- 円グラフが生成される
- 各商品の売上比率が表示される

**検証項目**:
- [ ] 円グラフが生成される
- [ ] 比率が正確である

---

### グループ5：高度な分析

#### テスト5.1：回帰分析
**前提条件**: テストデータセット3のB2:B5を選択（Q1の売上）

**操作**:
```
入力: 「トレンド分析して」
```

**期待される結果**:
- 回帰分析が実行される
- 回帰方程式が表示される
- R二乗値が表示される

**検証項目**:
- [ ] 分析が実行される
- [ ] 結果が数学的に正確である

---

#### テスト5.2：相関係数計算
**前提条件**: テストデータセット3のB2:C5を選択（Q1とQ2）

**操作**:
```
入力: 「Q1とQ2の相関を計算して」
```

**期待される結果**:
- 相関係数が計算される
- 相関の強さが解釈される

**検証項目**:
- [ ] 相関係数が計算される
- [ ] 解釈が適切である

---

### グループ6：エラーハンドリング

#### テスト6.1：セル未選択エラー
**前提条件**: セルを選択しない

**操作**:
```
入力: 「分析して」
```

**期待される結果**:
- エラーメッセージが表示される
- メッセージ：「データが選択されていません。セルを選択してからもう一度お試しください。」

**検証項目**:
- [ ] エラーメッセージが表示される
- [ ] メッセージが日本語である
- [ ] メッセージが分かりやすい

---

#### テスト6.2：APIキー未設定エラー
**前提条件**: OPENAI_API_KEYが設定されていない

**操作**:
```
入力: 「分析して」
```

**期待される結果**:
- エラーメッセージが表示される
- メッセージ：「設定が完了していません。README を確認してください。」

**検証項目**:
- [ ] エラーメッセージが表示される
- [ ] メッセージが分かりやすい

---

#### テスト6.3：無効なデータ形式
**前提条件**: テキストデータを選択

**操作**:
```
入力: 「合計を計算して」
```

**期待される結果**:
- エラーメッセージが表示される
- メッセージ：「データの形式が正しくありません。数値データを選択してください。」

**検証項目**:
- [ ] エラーメッセージが表示される
- [ ] 処理が中断される

---

### グループ7：UIと操作性

#### テスト7.1：メッセージ送信
**前提条件**: チャットUIが表示されている

**操作**:
```
1. テキストを入力
2. 「送信」ボタンをクリック
```

**期待される結果**:
- メッセージが送信される
- ローディング表示が出現
- AIの返答が表示される
- メッセージ履歴が保存される

**検証項目**:
- [ ] メッセージが送信される
- [ ] ローディング表示が出現する
- [ ] 返答が表示される
- [ ] 履歴が保存される

---

#### テスト7.2：キーボードショートカット
**前提条件**: テキストが入力されている

**操作**:
```
Ctrl+Enter（またはCmd+Enter）を押す
```

**期待される結果**:
- メッセージが送信される

**検証項目**:
- [ ] ショートカットが機能する

---

#### テスト7.3：スクロール動作
**前提条件**: 複数のメッセージが表示されている

**操作**:
```
新しいメッセージを送信
```

**期待される結果**:
- 自動的に最新メッセージまでスクロールされる

**検証項目**:
- [ ] スクロールが自動実行される

---

### グループ8：パフォーマンス

#### テスト8.1：レスポンス時間
**前提条件**: インターネット接続が正常

**操作**:
```
入力: 「分析して」
送信時間を計測
```

**期待される結果**:
- レスポンス時間：3-5秒以内

**検証項目**:
- [ ] レスポンス時間が許容範囲内

---

#### テスト8.2：大量データ処理
**前提条件**: 1000行以上のデータを選択

**操作**:
```
入力: 「分析して」
```

**期待される結果**:
- 処理が完了する（5-10秒以内）
- メモリリークがない

**検証項目**:
- [ ] 大量データが処理される
- [ ] 処理時間が許容範囲内

---

## テスト実行手順

### 1. テスト環境の準備

```bash
# 依存関係をインストール
npm install

# 環境変数を設定
cp .env.example .env
# .envにOpenAI APIキーを設定

# サーバーを起動
npm start
```

### 2. テストの実行

```bash
# 各テストケースを順番に実行
# 結果をテストレポートに記録
```

### 3. 結果の記録

テストレポートテンプレート：

```
テストケース: [テスト名]
実行日時: [日時]
テスター: [名前]
環境: [OS, ブラウザ]

結果: [成功/失敗]
詳細: [詳細説明]
スクリーンショット: [添付]
```

## テスト自動化

### Jest を使用したユニットテスト

```bash
npm test
```

### E2Eテスト（Cypress）

```bash
npm run test:e2e
```

## テスト結果の評価基準

| 項目 | 基準 | 判定 |
|------|------|------|
| 機能実装 | すべてのテストケースが成功 | ✓ |
| パフォーマンス | レスポンス時間 < 5秒 | ✓ |
| エラーハンドリング | すべてのエラーケースが処理される | ✓ |
| UI/UX | ユーザーが直感的に操作できる | ✓ |
| セキュリティ | APIキーが安全に管理されている | ✓ |

---

**最終更新**: 2025年10月21日

